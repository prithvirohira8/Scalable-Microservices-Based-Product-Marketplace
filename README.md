# Scalable Microservices Based Product Marketplace
### A microservice based online marketplace with additional fault tolerance & observability resembling the implementation of a large scale ecommerce website.
- [Project Architecture](#project-architecture)
- [Implementation Details](#implementation-details)
  - [Product Service](#product-service)
  - [Order Service](#order-service)
  - [Inventory Service](#inventory-service)
  - [API-Gateway Service](#api-gateway)
  - [Notification Service Service](#api-gateway)
- [Demonstration](#demonstration)

### Project Architecture
<div align="center">
  <img style="float: right;" src="./data/img/architecture.png" alt="Twitterify Logo">
</div>

#### Frameworks Used: 
- Spring Boot (Java), Kafka, Resilience4j, KeyCloak
- Angular
- MongoDB, MySQL
- Grafana, Loki, Prometheus, OpenTelemetry
- Docker, Kubernetes

### Implementation Details

#### Services

#### Product Service
The product serivce is a Spring Boot Service that allows the user to create new products and save it into the MongoDB database.

APIs exposed:
```
To create a new product: http://localhost:8080/api/product (POST REQUEST)
To test if a product is created: http://localhost:8080/api/product (GET REQUEST)
```

#### Order Service
The Order Service is a **Spring Boot** Service to submit an order for a product, which is stored in the **MySQL** Database.

Additionally **Flyway** is integrated to swiftly handle database migrations and swift updates to the database

APIs exposed:
```
To submit an order: http://localhost:8081/api/order (POST REQUEST)
```

Once an order is submitted, a Kafka message is created for it, using the Kafka Producer and Kafka Schema Registry. The messages are later consumed in the notification service and then the order summary is mailed.

#### Inventory Service
The inventory service is a Spring Boot Service that checks if a the desired quantity of thre product is present in the inventory using a MySQL Database.

APIs exposed:
```
Checking if a product is available at the desired quantity: http://localhost:8082/api/inventory?skuCode={product_name}&quantity={quantity} (GET REQUEST)
```

#### API Gateway
In order to abstract the endpoints of the services executing the business logic and enhance the security, the API-Gateway Service was added. The API-Gateway takes the requests from the client / frontend forwards them to the appropriate services and returns the response it receives from the services.
The API Gateway works at the port number 9000.
An example of using the API Gateway to get a product.

Keycloak is integrated to act as an Authorization Server and utilize the OAuth2 authorization protocol. A new token is generated using the client credentials and used with each request to add security.

Additionally, the circuit breaker pattern is used with resilience4j to add resilience, stability and prevent Cascading Failures.

```
http://localhost:9000/api/product (GET REQUEST)

Response:
[
  {
    "id": "661b5c40ad645e4a98d0f623",
    "name": "iPhone 15",
    "description": "iPhone 15 is a smartphone from Apple",
    "price": 1000
  }
]
```

#### Notification Service
The notification service consumes the messages from the order-service using a KafkaListener and sends a mail with the order details using Java Mail Sender dependency.

#### Frontend Service
This represents the frontend of the application. It's built using Angular and allows users to login, register, create & order products.

#### Observability & Monitoring
Promotheus and Grafana were incorporated in each service to view the logs and metrics.

#### Deployment of Services
Cloud Native Build Packs were used to build the docker images.
Kubernetes deployments were created using the services ensuring service availibility. The deployments used ConfigMaps & Secrets to store environment variables and sensitive data such as database credentials as well as Persistent Volumes (PV) to manage storage needs for databases and stateful services
Horizontal Pod Autoscaler (HPA) could be integrated in the future to ensure that the service scale based on CPU and Memory Useage.

### Demonstration
A walkthrough to the entire process from user registration, to creating products, ordering products and the analysis generated by Grafana Dashboards:

![Homepage Diagram](./data/img/homepage.png?raw=true "Homepage Diagram")
![Loginpage Diagram](./data/img/loginpage.png?raw=true "Loginpage Diagram")
![Loginpage Diagram](./data/img/registerpage.png?raw=true "Loginpage Diagram")
![Loginpage Diagram](./data/img/homepage(2).png?raw=true "Loginpage Diagram")
![Homepage Diagram](./data/img/homepage(3).png?raw=true "Homepage Diagram")
![Homepage Diagram](./data/img/homepage(4).png?raw=true "Homepage Diagram")
![Homepage Diagram](./data/img/homepage(5).png?raw=true "Homepage Diagram")
![Homepage Diagram](./data/img/homepage(6).png?raw=true "Homepage Diagram")
![Monitoring Diagram](./data/img/tempo_obs.png?raw=true "Monitoring Diagram")
![Monitoring Diagram](./data/img/prometheus_obs.png?raw=true "Monitoring Diagram")
![Monitoring Diagram](./data/img/grafana_dashboard.png?raw=true "Monitoring Diagram")
![Monitoring Diagram](./data/img/grafana_dashboard(2).png?raw=true "Monitoring Diagram")
![Monitoring Diagram](./data/img/grafana_dashboard(3).png?raw=true "Monitoring Diagram")
